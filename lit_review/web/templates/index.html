<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Literature Review Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .search-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 0;
        }
        .card-hover {
            transition: transform 0.2s;
        }
        .card-hover:hover {
            transform: translateY(-5px);
        }
        .stats-card {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        .citation-badge {
            background-color: #e3f2fd;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-book"></i> Literature Review Platform
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#search">Search</a>
                <a class="nav-link" href="#analysis">Analysis</a>
                <a class="nav-link" href="#statistics">Statistics</a>
            </div>
        </div>
    </nav>

    <div class="search-container" id="search">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <h1 class="text-center mb-4">Mathematics Education Literature Search</h1>
                    <div class="card">
                        <div class="card-body">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control form-control-lg" 
                                       id="searchInput" 
                                       placeholder="Search for papers, authors, or concepts...">
                                <button class="btn btn-primary btn-lg" type="button" onclick="performSearch()">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="semanticSearch" checked>
                                        <label class="form-check-label" for="semanticSearch">
                                            Semantic Search
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <select class="form-select" id="searchLimit">
                                        <option value="10">10 results</option>
                                        <option value="20" selected>20 results</option>
                                        <option value="50">50 results</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4" id="statistics">
        <h2>Collection Statistics</h2>
        <div class="row" id="statsContainer">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h3 id="totalDocs">-</h3>
                        <p>Total Documents</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h3 id="totalAuthors">-</h3>
                        <p>Total Authors</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h3 id="totalCitations">-</h3>
                        <p>Total Citations</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body text-center">
                        <h3 id="totalKeywords">-</h3>
                        <p>Total Keywords</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <h3>Search Results</h3>
                <div id="searchResults">
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-search fa-3x mb-3"></i>
                        <p>Use the search box above to find papers on mathematics education topics like:</p>
                        <ul class="list-unstyled">
                            <li><strong>Cognitively Guided Instruction</strong></li>
                            <li><strong>Problem-based Learning</strong></li>
                            <li><strong>Mathematical Reasoning</strong></li>
                            <li><strong>Number Sense</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <h3>Quick Analysis</h3>
                <div class="card">
                    <div class="card-body">
                        <h6>Natural Language Queries</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm" onclick="queryExample('cognitively guided instruction')">
                                Papers on CGI
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="queryExample('most cited papers')">
                                Most Cited Papers
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="queryExample('collaborative learning mathematics')">
                                Collaborative Learning
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API base URL
        const API_BASE = '/api';

        // Load statistics on page load
        window.addEventListener('load', function() {
            loadStatistics();
        });

        // Load collection statistics
        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics`);
                const data = await response.json();
                
                if (data.database) {
                    document.getElementById('totalDocs').textContent = data.database.total_documents || 0;
                    document.getElementById('totalAuthors').textContent = data.database.total_authors || 0;
                    document.getElementById('totalCitations').textContent = data.database.total_citations || 0;
                    document.getElementById('totalKeywords').textContent = data.database.total_keywords || 0;
                }
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Perform search
        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const semantic = document.getElementById('semanticSearch').checked;
            const limit = document.getElementById('searchLimit').value;

            showLoading();

            try {
                const params = new URLSearchParams({
                    q: query,
                    semantic: semantic,
                    limit: limit
                });

                const response = await fetch(`${API_BASE}/search?${params}`);
                const data = await response.json();

                displaySearchResults(data);
            } catch (error) {
                console.error('Search error:', error);
                showError('Search failed. Please try again.');
            }
        }

        // Query example
        async function queryExample(query) {
            document.getElementById('searchInput').value = query;
            await performSearch();
        }

        // Display search results
        function displaySearchResults(data) {
            const container = document.getElementById('searchResults');
            
            if (!data.documents || data.documents.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-search-minus fa-3x mb-3"></i>
                        <p>No results found for your search.</p>
                    </div>
                `;
                return;
            }

            const resultsHtml = data.documents.map(doc => `
                <div class="card mb-3 card-hover">
                    <div class="card-body">
                        <h5 class="card-title">${doc.title}</h5>
                        <p class="text-muted mb-2">
                            ${doc.authors ? doc.authors.map(a => a.name).join(', ') : 'Unknown authors'}
                            ${doc.publication_year ? `(${doc.publication_year})` : ''}
                        </p>
                        ${doc.abstract ? `<p class="card-text">${doc.abstract.substring(0, 300)}...</p>` : ''}
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                ${doc.keywords ? doc.keywords.slice(0, 3).map(k => 
                                    `<span class="badge citation-badge me-1">${k}</span>`
                                ).join('') : ''}
                            </div>
                            <div>
                                ${doc.similarity_score ? `<small class="text-muted">Similarity: ${(doc.similarity_score * 100).toFixed(1)}%</small>` : ''}
                                <button class="btn btn-sm btn-outline-primary ms-2" onclick="viewDocument(${doc.id})">
                                    View Details
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="mb-3">
                    <small class="text-muted">
                        Found ${data.total} results using ${data.search_type} search
                    </small>
                </div>
                ${resultsHtml}
            `;
        }

        // View document details
        async function viewDocument(docId) {
            try {
                const response = await fetch(`${API_BASE}/documents/${docId}`);
                const data = await response.json();

                // Simple modal display (could be enhanced)
                alert(`Document: ${data.document.title}\\n\\nAbstract: ${data.document.abstract || 'No abstract available'}`);
            } catch (error) {
                console.error('Error viewing document:', error);
            }
        }

        // Show loading state
        function showLoading() {
            document.getElementById('searchResults').innerHTML = `
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Searching...</p>
                </div>
            `;
        }

        // Show error message
        function showError(message) {
            document.getElementById('searchResults').innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-triangle"></i> ${message}
                </div>
            `;
        }

        // Enter key search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    </script>
</body>
</html>